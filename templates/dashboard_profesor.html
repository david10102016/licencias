{% extends "base.html" %}

{% block title %}Panel del Profesor{% endblock %}

{% block content %}
  <div class="card mb-2">
    <div class="card-body">
      <div class="text-center">
        {% if foto %}
          <img src="{{ url_for('static', filename='uploads/' ~ foto) }}" alt="Foto de perfil" class="profile-pic" style="width: 120px; height: 120px; margin-bottom: 1rem;">
        {% else %}
          <img src="{{ url_for('static', filename='uploads/default-user.png') }}" alt="Foto de perfil por defecto" class="profile-pic" style="width: 120px; height: 120px; margin-bottom: 1rem;">
        {% endif %}
        <h2 class="mb-2">Bienvenido, {{ session['user_name'] }}</h2>
        <div class="mt-2">
          <a href="{{ url_for('solicitudes') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Nueva solicitud
          </a>
          <a href="{{ url_for('cambiar_contrasena') }}" class="btn btn-secondary">
            <i class="fas fa-key"></i> Cambiar contraseña
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="stat-card mb-2">
    <div class="stat-number">{{ licencias|length }}</div>
    <div class="stat-label">Solicitudes Totales</div>
  </div>

  <h3 class="mb-2"><i class="fas fa-clipboard-list"></i> Mis Solicitudes de Licencia</h3>
  
  {% if licencias %}
    <div class="cards-container">
      {% for licencia in licencias %}
        <div class="card">
          <div class="card-header">
            <i class="fas fa-calendar-alt"></i>
            {{ licencia['fecha_inicio'] }} - {{ licencia['fecha_fin'] }}
          </div>
          <div class="card-body">
            <p><strong>Motivo:</strong><br>{{ licencia['motivo'] }}</p>
            <span class="status-badge status-{{ licencia['estado']|lower }}">
              {% if licencia['estado'] == 'En espera' %}
                <i class="fas fa-clock"></i>
              {% elif licencia['estado'] == 'Aprobada' %}
                <i class="fas fa-check-circle"></i>
              {% else %}
                <i class="fas fa-times-circle"></i>
              {% endif %}
              {{ licencia['estado'] }}
            </span>
          </div>
          {% if licencia['archivo'] %}
          <div class="card-footer">
            <a href="{{ url_for('static', filename='comprobantes/' ~ licencia['archivo']) }}" 
               target="_blank" 
               class="btn btn-primary">
              <i class="fas fa-file-alt"></i> Ver comprobante
            </a>
          </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="card">
      <div class="card-body text-center">
        <i class="fas fa-inbox fa-3x mb-2" style="color: var(--light-gray);"></i>
        <p>No has enviado solicitudes aún.</p>
        <a href="{{ url_for('solicitudes') }}" class="btn btn-primary">
          <i class="fas fa-plus"></i> Crear primera solicitud
        </a>
      </div>
    </div>
  {% endif %}
{% endblock %}
